# 918前端启动问题（总结与长期解决方案）

## 一、问题清单（按出现顺序）
1) PowerShell 无法使用 &&
- 现象：cd ... && npm run dev 报错&& 不是有效语句分隔符。
- 解决：PowerShell 分步执行：
  - cd E:\langApp514\frontend\my-web-ui
  - npm run dev

2) Vite 默认端口不一致 / 被占用
- 现象：期望 5173，但 Vite 使用 3000；3000 被占用时又切至 3001，导致访问口径不一致。
- 解决：统一端口配置（已将 vite.config.js 设置为 5173，含 host: true，strictPort: false 允许自动切换）；启动后用 Network 面板确认端口；无法访问时同时尝试 5173 与 3001。

3) 前端源码编码/内容损坏导致 Vite import-analysis 失败
- 现象：src/services/api.js 出现乱码与非法 JS 语法，Vite 报错 Failed to parse source。
- 解决：重写 src/services/api.js 为有效 UTF-8，标准 Axios 配置与拦截器、API 函数齐全。

4) 后端未返回真实数据，前端文章为空
- 现象：/api/articles 返回固定/假数据或接口超时、404；文章页为空。
- 解决：
  - 停止占用 8000 端口的临时后端进程。
  - 启动真实数据后端 frontend/my-web-ui/backend/server.py，从 real_data_raw/result 扫描 _processed_*.json。
  - 验证 GET http://localhost:8000/api/articles 返回 data:[{text_id,text_title,total_*}]。

5) 文章详情 tokens 字段不兼容
- 现象：前端仅读取 token_body，真实数据为 token 字段，文章文本不显示。
- 解决：ArticleViewer.jsx 渲染回退：优先 token_body，无则使用 token，保证文本显示。

## 二、关键改动与文件
- frontend/my-web-ui/vite.config.js：统一端口（5173）、host: true、strictPort: false。
- frontend/my-web-ui/src/services/api.js：用 UTF-8 重写，baseURL 指向 http://localhost:8000，补齐所有 API 方法。
- frontend/my-web-ui/src/modules/article/components/ArticleViewer.jsx：displayText 增加 token_body || token 回退。
- 后端真实数据服务：frontend/my-web-ui/backend/server.py（读取 E:\langApp514\real_data_raw\result）。

## 三、稳定启动指引（每次成功）
A. 启动真实数据后端
- PowerShell 逐条执行：
```
cd E:\langApp514\frontend\my-web-ui\backend
python server.py | cat
```
成功标志：日志含 Uvicorn running on http://0.0.0.0:8000，且访问：
```
Invoke-WebRequest http://localhost:8000/api/articles | Select-Object -Expand Content
```
能返回包含 text_id 的列表。

B. 启动前端 Vite
- 新开 PowerShell 窗口，逐条执行：
```
cd E:\langApp514\frontend\my-web-ui
npm run dev
```
成功标志：控制台显示启动端口（5173 或 3001）。如 5173 被占用，会自动切到 3001。

C. 浏览器访问
- 前端 UI：http://localhost:5173（或控制台提示的端口 http://localhost:3001）
- 后端 API：http://localhost:8000
- API 文档：http://localhost:8000/docs

D. 快速自检
- 如文章列表为空：
  1) 检查 http://localhost:8000/api/articles 是否 {"data":[...]}。
  2) E:\langApp514\real_data_raw\result 是否有 _processed_*.json，包含 text_id/text_title/sentences/tokens。
  3) 打开文章详情的 Network，确认 GET /api/articles/{id} 返回 sentences[*].tokens[*].token 或 token_body。

## 四、常见故障与一键修复
- 端口被占用：
```
Get-NetTCPConnection -LocalPort 8000 -State Listen | Select OwningProcess
Stop-Process -Id <PID> -Force
```
- PowerShell 不支持 &&：分两行执行 cd 与命令。
- Vite 编译失败（文件损坏）：重置 src/services/api.js 为有效 UTF-8 版本。
- 文章无内容：已在 ArticleViewer.jsx 兼容 token_body/token；若后端字段变化，按 Network 响应调整映射。

## 五、可选：统一启动脚本
如需一键体验，建议使用两个独立窗口按三、稳定启动指引手动执行，避免脚本在端口或环境差异下失败。

## 附录：命令行速查

### 后端（真实数据）
```powershell
cd E:\langApp514\frontend\my-web-ui\backend
python server.py | cat
Invoke-WebRequest http://localhost:8000/api/articles | Select-Object -Expand Content
```

### 前端（Vite）
```powershell
cd E:\langApp514\frontend\my-web-ui
npm run dev
```

### 若仍报「Unexpected ""」或 Vite 启动失败
```powershell
rd /s /q node_modules
del package-lock.json
npm install
npm run dev
```

最后更新：2025-09-18
