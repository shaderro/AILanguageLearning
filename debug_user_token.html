<!DOCTYPE html>
<html>
<head>
    <title>Token Debug</title>
</head>
<body>
    <h1>Token 调试工具</h1>
    
    <div>
        <h2>当前 localStorage 信息：</h2>
        <pre id="storage"></pre>
    </div>
    
    <div>
        <h2>解码 Token：</h2>
        <pre id="decoded"></pre>
    </div>
    
    <div>
        <h2>测试 API：</h2>
        <button onclick="testVocabAPI()">测试词汇 API</button>
        <pre id="result"></pre>
    </div>
    
    <script>
        // 显示 localStorage
        const storage = {
            user_id: localStorage.getItem('user_id'),
            access_token: localStorage.getItem('access_token')
        };
        document.getElementById('storage').textContent = JSON.stringify(storage, null, 2);
        
        // 解码 JWT token
        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                return { error: e.message };
            }
        }
        
        const token = localStorage.getItem('access_token');
        if (token) {
            const decoded = parseJwt(token);
            document.getElementById('decoded').textContent = JSON.stringify(decoded, null, 2);
        } else {
            document.getElementById('decoded').textContent = 'No token found';
        }
        
        // 测试 API
        async function testVocabAPI() {
            const resultEl = document.getElementById('result');
            resultEl.textContent = 'Testing...';
            
            try {
                const response = await fetch('http://localhost:8001/api/v2/vocab/', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });
                
                const data = await response.json();
                resultEl.textContent = JSON.stringify({
                    status: response.status,
                    data: data
                }, null, 2);
            } catch (e) {
                resultEl.textContent = 'Error: ' + e.message;
            }
        }
    </script>
</body>
</html>

